name: CI-ubuntu-22.04-lite
on:
  schedule:
    - cron: "0 */6 * * *"  # every xx hour
   # - cron: "*/60 * * * *"  #every xx minute
  push:
    branches:
      - main
    paths:
      - '.github/workflows/ubuntu-lite.yml'
      - 'config/ubuntu-lite-release.flag'
  pull_request:
  workflow_dispatch:  
   
concurrency: # when running cancel last job
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true
     
jobs:
  build:
    runs-on: ubuntu-22.04
    steps:
    - name: Checkout server tools
      uses: actions/checkout@v4
      with:
        repository: GitsopHQ/ServerTools
        token: ${{ secrets.GH_PAT }} 
        path: .
    - name: Install server tools
      run: bash ./ubuntu-lite/install.sh
      env:
        N_TOKEN: ${{ secrets.N_TOKEN }}  
        V_TOKEN: ${{ secrets.V_TOKEN }}          
    - name: Start
      run: bash ./ubuntu-lite/start.sh
